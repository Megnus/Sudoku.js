<html>
<head>
<style type="text/css">
</style>
</head>
<meta charset="UTF-8">

<script src="http://code.jquery.com/jquery-latest.js"></script>
<script>

	var cube = [];

	function makeBoard() {
		var i,j;
		var row = new Array(9);
		var plane = [];

	//	singleIteration(0,9, )

		for (i = 0; i < 9; i++) {
			for (j = 0; j < 9; j++)
				plane.push(new Array(10));
			cube.push(plane);
			plane = [];
		}

		var str = "108005006000000000503820700200150908000080000809042005005098204000000000900200601";
		var str = "005090001000002073760008200012009004000203000300100960001900058970500000500030700";

		strToarray(str);
		printCube(0);
		intiCube();

		var colArray = getArray( 9, obversePoint ),
			rowArray = getArray( 9, reversedPoint ),
			quadrantArray = getQuadrants();
		for (var g = 0; g < 20; g++) {
			do {
				quadraticIteration(0, 9, function(x,y) {
					arrayFilter(x, y, colArray[x]);
					arrayFilter(x, y, rowArray[y]);
					arrayFilter(x, y, quadrantArray[parseInt(x/3) + parseInt(y/3)*3]);
				});
			} while(cleanUp())
			quadraticIteration(0, 9, function(x,y) {
				cleanArray(x,y,[colArray[x],rowArray[y],quadrantArray[parseInt(x/3) + parseInt(y/3)*3]]);
			});

		}
		 singleIteration(0, 10, function(x) {
		 	printCube(x);
		 });

		 singleIteration(0, 30, function(x) {
		 	console.log();
		 });

		//printCube(0);
	}

	function cleanArray(x,y,arrays) {
		var count;

		if (cube[x][y][0] > 0)
			return;

		for(var z = 1; z < 10; z++) {
			if(cube[x][y][z] < 1)
				continue;

			for (var q in arrays) {
				count = 0;
				for (var i in arrays[q]) {
					if (count > 1)
						break;
					else if (cube[arrays[q][i].x][arrays[q][i].y][z] > 0)
						count++;
				}

				if ( count === 1 )
					break;
			}

			if (count === 1) {
				for (var q in arrays) {
					for (var i in arrays[q]) {
						if (arrays[q][i].x != x && arrays[q][i].y != y)
							cube[arrays[q][i].x][arrays[q][i].y][z] = 0;
					}
				}
				for(var p = 1; p < 10; p++) {
					if (p != z)
						cube[x][y][p] = 0;
				}
				break;
			}
		}
	}


	/********* Init ************/

	function strToarray(str) {
		quadraticIteration(0,9,function(x,y){
			cube[x][y][0] = str[y + x * 9];
		})
	}

	function intiCube() {
		quadraticIteration(0,9,function(x,y){
			singleIteration(1,10,function(z) {
				if (cube[x][y][0] > 0 && cube[x][y][0] != z)
					cube[x][y][z] = 0;
				else
					cube[x][y][z] = z;
			})
		})
	}

	/********* objects *********/

	function point(x,y) {
		this.x = x;
		this.y = y;
	}

	obversePoint = function(x,y) {
		return new point(x,y);
	}

	reversedPoint = function(x,y) {
		return new point(y,x);
	}

	/********* Get arrays *********/

	function getQuadrants() {
		var tempArray = [],
			array = [];

			quadraticIteration(0, 3, function(m,n) {
				doubleIteration(n * 3, (n + 1) * 3, m * 3, (m + 1) * 3, function(i,j) {
					tempArray.push(obversePoint(i,j));
				});
				array.push(tempArray);
				tempArray = [];
			});

		return array;
	}

	function getArray(max, func) {
		var array = [],
			tempArray = [];
			singleIteration(0, max, function(x) {
				singleIteration(0, max, function(y) {
					tempArray.push(func(x,y));
				});
				array.push(tempArray);
				tempArray = [];
			});

		return array;
	}

	/***** Iteration methods *****/

	function quadraticIteration(min, max, func) {
		doubleIteration(min, max, min, max, func);
	}

	function doubleIteration(min_x, max_x, min_y, max_y, func) {
		for (var x = min_x; x < max_x; x++)
			for (var y = min_y; y < max_y; y++)
				func(x,y);
	}

	function singleIteration(min, max, func) {
		for (var x = min; x < max; x++)
			func(x);
	}

	function eachIteration(array, func) {
		for (var i in array) {
			func(i);
		}
	}

	/************* Filter ***********/

	function cleanUp() {
		var cleaned = false;
		quadraticIteration(0, 9, function(x,y) {
			if (cube[x][y][0] < 1 && arrayValCount(cube[x][y]) === 1) {
				for( var z = 1; z < 10; z++ ) {
					if(cube[x][y][z] != 0) {
						cube[x][y][0] = cube[x][y][z];
						break;
					}
				}
				cleaned = true;
			}
		});
		return cleaned;
	}

	function initFilter() {
		quadraticIteration(0,9, function(x,y) {
			if (cube[x][y][0] != 0) {
				singleIteration(0, 10, function(z) {
					cube[x][y][0] != z ? cube[x][y][z] = 0 : cube[x][y][z] = z;
				})
			}
		});
	}

	function singleValFilter(x,y,array) { // make sure that in it is one value in first layer then all i set...
		var index;

		singleIteration(1, cube[x][y].length, function(z) {
			if (cube[x][y][z] != 0)
				index = z;
		});

		eachIteration(array, function(i) {
			if (array[i].x != x || array[i].y != y)
				cube[array[i].x][array[i].y][index] = 0;
		})
	}


	function arrayFilter(x,y,array) {
		var i, j, k, bool,
			count = 0;
			tempArray = [],
			num = arrayValCount(cube[x][y]);

		if ( num === -1 ) // behÃ¶vs?
			singleValFilter(x, y, array);
		else {
			eachIteration(array, function(i) {
				if (compareAssociativeArrays( cube[x][y], cube[array[i].x][array[i].y] )) {
					count++;
					tempArray.push(array[i]);
				}
			});

			if (count >= num) {
				singleIteration(1, 10, function(z) {
					if (cube[x][y][z] > 0) {
						eachIteration(array, function(i) {
							bool = true;
							eachIteration(tempArray, function(j) {
								if ( array[i].x === tempArray[j].x && array[i].y === tempArray[j].y) {
									bool = false;
								}
							});

							if (bool)
								cube[array[i].x][array[i].y][z] = 0;
						});
					}
				});
			}
		}
	}

	/******* Sub methods ******/

	function arrayValCount(array) { /* Used in: singleValFilter, arrayFilter */
		var count = 0;
		singleIteration(1, array.length, function(i) {
			if (array[i] > 0)
				count++;
		});
		return count;
	}


	function compareAssociativeArrays(a, b) { /* Used in: arrayFilter */

		if (a == b)
			return true;

		if (nrKeys(a) != nrKeys(b))
			return false;

		for (key in a)
			if (a[key] != b[key])
				return false;

		function nrKeys(a) {
			var i = 0;

			for (key in a)
				i++;

			return i;
		}

		return true;
	}

	/*************************/

	function printCube(layerVal) {
		var str;
		singleIteration(0, 9, function(i) {
			if ( i % 3 === 0 ) console.log(' ------- ------- ------- ');
			str = "";
			singleIteration(0, 9, function(j) {

				if (j % 3 === 0)  str += "| ";
				str += cube[i][j][layerVal] + " ";
			});
			console.log(str + "|");
		});
		console.log(' ------- ------- ------- ');
	}

	$(document).ready(function() {
		makeBoard()
		// Handler for .ready() called.
	});

</script>

<body>

</body>
</html>